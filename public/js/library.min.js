"use strict";var Utils={CSRFToken:null,makeConnection:function(){try{return new XMLHttpRequest}catch(e){}try{return new ActiveXObject("Msxml3.XMLHTTP")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}return null},getCSRFToken:function(e){if(null!==this.CSRFToken)return this.CSRFToken;var t=document.querySelector('meta[name="csrf-token"]');return t=null===t?null:t.getAttribute("content"),this.CSRFToken=t,t},getParam:function(e){var t=window.location.href.indexOf("?");if(t<0)return null;t=window.location.href.substr(t+1).split("&");for(var r=0;r<t.length;r++){var n=t[r].split("=");if(n[0]===e)return decodeURIComponent(n[1])}return null},stringifyCounterValue:function(e){return e=parseInt(e),!0===isNaN(e)||e<=0?"0":(e=Math.abs(e),Math.floor(e/1e3)>0?(e/=1e3,Math.floor(e/1e3)>0?(e/=1e3,Math.floor(e/1e3)>0?(e/=1e3,Math.floor(e/1e3)>0?(e/=1e3,Math.floor(e/1e3)>0?Math.floor(e/1e3)+" P":Math.floor(e)+" T"):Math.floor(e)+" G"):Math.floor(e)+" M"):Math.floor(e)+" K"):e.toString())},handleHTTPError:function(e,t,r){if(200!==e){switch(e){case 403:!0===t&&UI.alert.show("You need to be logged in before using this feature.","Login required.","error");break;case 405:!0===r&&UI.alert.show("This feature is reserved to admins only.","Action not allowed.","error");break;case 419:UI.alert.show("Your session has expired, page needs to be reloaded.","Session expired.","message",function(){window.location.reload(!0)})}return 403===e&&!0===t||405===e&&!0===r||419===e||UI.alert.show("An unexpected error has occurred, please retry later.","Unable to complete the action.","error"),!1}return!0}},UI={dataContainer:function(){this.loader=null,this.error=null,this.list=null,this.showLoader=function(){return this.error.style.opacity="0",this.list.style.opacity="0",window.setTimeout(function(){this.error.style.display="none",this.list.style.display="none",this.loader.style.display="block",this.loader.style.opacity="1"}.bind(this),250),this},this.showError=function(){return this.loader.style.opacity="0",this.list.style.opacity="0",window.setTimeout(function(){this.loader.style.display="none",this.list.style.display="none",this.error.style.display="block",this.error.style.opacity="1"}.bind(this),250),this},this.showList=function(e){return this.loader.style.opacity="0",this.error.style.opacity="0",window.setTimeout(function(){this.loader.style.display="none",this.error.style.display="none",this.list.style.display=!0===e?"table":"block",this.list.style.opacity="1"}.bind(this),250),this}},form:{showLogin:function(){UI.menu.close();var e=document.getElementById("form-login"),t=document.getElementById("form-overlay");e.style.display="block",t.style.display="block",window.setTimeout(function(){e.style.opacity="1",t.style.opacity="1"},25)},hideLogin:function(e){var t=document.getElementById("form-login"),r=document.getElementById("form-overlay");r.style.opacity="0",t.style.opacity="0",window.setTimeout(function(){t.style.display="none",r.style.display="none",!0===e&&(document.getElementById("form-login-email").value="",document.getElementById("form-login-password").value="")},250)},showRegistration:function(){UI.menu.close();var e=document.getElementById("form-register"),t=document.getElementById("form-overlay");e.style.display="block",t.style.display="block",window.setTimeout(function(){e.style.opacity="1",t.style.opacity="1"},25)},hideRegistration:function(e){var t=document.getElementById("form-register"),r=document.getElementById("form-overlay");r.style.opacity="0",t.style.opacity="0",window.setTimeout(function(){if(t.style.display="none",r.style.display="none",!0===e){document.getElementById("form-register-name").value="",document.getElementById("form-register-surname").value="",document.getElementById("form-register-email").value="",document.getElementById("form-register-password").value="";for(var n=document.querySelectorAll(".form-register-validation"),o=0;o<n.length;o++)n.item(o).style.display="none";document.getElementById("form-register-password-progress").style.display="none",document.getElementById("form-register-password-progress-value").style.width="0%",UI.form.resetRegistrationSize()}},250)},resetRegistrationSize:function(){for(var e=0,t=document.querySelectorAll(".form-register-validation"),r=0;r<t.length;r++)"block"===t.item(r).style.display&&e++;"block"===document.getElementById("form-register-password-progress").style.display&&e++,document.getElementById("form-register").setAttribute("messages",e.toString())},hideAll:function(){this.hideLogin(),this.hideRegistration(),UI.menu.close()}},menu:{toggle:function(){var e=document.getElementById("header-content-mobile"),t=document.getElementById("header-overlay");"block"!==e.style.display?window.innerWidth<=480&&(e.style.display="block",t.style.display="block",window.setTimeout(function(){e.style.opacity="1",t.style.opacity="1"},25)):this.close()},close:function(){var e=document.getElementById("header-content-mobile");if("block"===e.style.display){var t=document.getElementById("header-overlay");e.style.opacity="0",t.style.opacity="0",window.setTimeout(function(){e.style.display="none",t.style.display="none"},250)}},setOrdering:function(e,t){var r=window.location.href.substr(window.location.href.lastIndexOf("/")+1);r.lastIndexOf("#")>=0&&(r=r.substr(0,r.lastIndexOf("#"))),""===r&&(e.preventDefault(),e.stopPropagation(),UI.menu.close(),MEME.setOrdering(t))}},cookiePolicy:{checkAgreement:function(){for(var e=decodeURIComponent(document.cookie).split(";"),t=0;t<e.length;t++){var r=e[t].trim();if(0===r.indexOf("cl"))return"cl=1"===r}return!1},show:function(){document.getElementById("cookie-policy").style.display="block"},agree:function(){var e=new Date;e.setTime(e.getTime()+2592e6),document.cookie="cl=1;expires="+e.toGMTString()+";path=/",document.getElementById("cookie-policy").style.display="none"}},alert:{show:function(e,t,r,n){var o,a=document.createElement("div");(a.className="alert",a.setAttribute("scope","string"==typeof r?r:""),"string"==typeof t&&""!==t)&&((o=document.createElement("p")).className="common-text alert-title",o.textContent=t,a.appendChild(o));"function"==typeof n&&(a.onClose=n),(o=document.createElement("p")).className="common-text alert-text",o.textContent=e,a.appendChild(o);var s=document.createElement("button");s.className="common-text alert-button",s.title="Close",s.textContent="Close",s.onclick=UI.alert.closeAll,a.appendChild(s);var l=UI.alert.closeAll(!1),i=document.getElementById("alert-overlay");null===i&&((i=document.createElement("div")).id="alert-overlay",i.className="alert-overlay",i.onclick=UI.alert.closeAll,document.body.appendChild(i)),document.body.appendChild(a),i.style.display="block",window.setTimeout(function(){a.style.opacity="1",i.style.opacity="1"},!0===l?275:25)},closeAll:function(e){for(var t="object"==typeof e,r=document.body.querySelectorAll("div.alert"),n=0;n<r.length;n++)!0===t&&"function"==typeof r[n].onClose&&r[n].onClose.call(this),r[n].style.opacity="0";if(r.length>0&&window.setTimeout(function(){for(var e=document.body.querySelectorAll("div.alert"),t=0;t<e.length;t++)e[t].parentNode.removeChild(e[t])},250),!1!==e){var o=document.getElementById("alert-overlay");o.style.opacity="0",window.setTimeout(function(){o.style.display="none"},250)}return 0!==r.length}}},User={page:1,authenticator:{triggerLogin:function(e){e.preventDefault(),e.stopPropagation(),User.authenticator.login()},login:function(){var e=document.getElementById("form-login-email").value;if(""===e||e.length>256)return UI.alert.show("You must provide a valid e-mail address.","Invalid e-mail address.","error");var t=document.getElementById("form-login-password").value;if(""===t||t.length>30)return UI.alert.show("You must provide a password, max length is 30 chars.","Invalid password.","error");var r=!0===document.getElementById("form-login-remember").checked?"1":"0",n=Utils.makeConnection();n.open("POST",document.getElementById("form-login").action,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.setRequestHeader("X-CSRF-Token",Utils.getCSRFToken()),n.onreadystatechange=function(){if(n.readyState>3){if(!1===Utils.handleHTTPError(n.status,!1))return!1;try{var e=JSON.parse(n.responseText);if("string"!=typeof e.result||"success"!==e.result)switch("number"!=typeof e.code?null:e.code){case 1:return UI.alert.show("You must provide a valid e-mail address.","Invalid e-mail address.","error");case 2:return UI.alert.show("You must provide a password, max length is 30 chars.","Invalid password.","error");case 3:return UI.alert.show("Check your credentials or restore password if forgotten.","Wrong credentials.","error");default:return UI.alert.show("An unexpected error has occurred, please retry later.","Unable to complete the action.","error")}UI.alert.show("Welcome back!","Logged in!","success",function(){window.location.reload(!0)})}catch(e){return console.log(e),UI.alert.show("An unexpected error has occurred, please retry later.","Unable to complete the action.","error")}}},n.send("email="+encodeURIComponent(e)+"&password="+encodeURIComponent(t)+"&remember="+r)},triggerRegister:function(e){e.preventDefault(),e.stopPropagation(),User.authenticator.register()},register:function(){var e=document.getElementById("form-register-name").value;if(""===e||e.length>30)return UI.alert.show("You must provide a name, max length is 30 chars.","Invalid name.","error");var t=document.getElementById("form-register-surname").value;if(""===t||t.length>30)return UI.alert.show("You must provide a surname, max length is 30 chars.","Invalid surname.","error");var r=document.getElementById("form-register-email").value;if(""===r||r.length>256)return UI.alert.show("You must provide a valid e-mail address.","Invalid e-mail address.","error");var n=document.getElementById("form-register-password").value;if(""===n||n.length>30)return UI.alert.show("You must provide a password, max length is 30 chars.","Invalid password.","error");var o=Utils.makeConnection();o.open("POST",document.getElementById("form-register").action,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.setRequestHeader("X-CSRF-Token",Utils.getCSRFToken()),o.onreadystatechange=function(){if(o.readyState>3){if(!1===Utils.handleHTTPError(o.status,!1))return!1;try{var e=JSON.parse(o.responseText);if("string"!=typeof e.result||"success"!==e.result)switch("number"!=typeof e.code?null:e.code){case 1:case 2:return UI.alert.show("You must provide a surname, max length is 30 chars.","Invalid surname.","error");case 3:return UI.alert.show("You must provide a valid e-mail address.","Invalid e-mail address.","error");case 4:return UI.alert.show("You must provide a password, max length is 30 chars.","Invalid password.","error");case 5:return UI.alert.show("An user with the same e-mail address already exists.","User already existing.","error");case 7:return UI.alert.show("Your e-mail address appears to be invalid or not existing.","Invalid e-mail address.","error");case 8:return UI.alert.show("Your e-mail address is disposable or not accepted.","Invalid e-mail address.","error");default:return UI.alert.show("An unexpected error has occurred, please retry later.","Unable to complete the action.","error")}alert("Registration completed!"),window.setTimeout(function(){window.location.reload(!0)},1e3)}catch(e){return console.log(e),UI.alert.show("An unexpected error has occurred, please retry later.","Unable to complete the action.","error")}}},o.send("name="+encodeURIComponent(e)+"&surname="+encodeURIComponent(t)+"&email="+encodeURIComponent(r)+"&password="+encodeURIComponent(n))},validateEmail:function(e){var t=document.getElementById("user-edit-email-validation-ok"),r="";if(null===t){if(null===(t=document.getElementById("form-register-email-validation-ok")))return;document.getElementById("form-register-email-validation-error-1").style.display="none",document.getElementById("form-register-email-validation-error-2").style.display="none",r="form-register-email-validation-"}else document.getElementById("user-edit-email-validation-error-1").style.display="none",document.getElementById("user-edit-email-validation-error-2").style.display="none",r="user-edit-email-validation-";if(t.style.display="none","form-register-email-validation-"===r&&UI.form.resetRegistrationSize(),!(""===e.target.value||e.target.value.length>256)){var n=Utils.makeConnection();n.open("POST","/validateEmail",!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.setRequestHeader("X-CSRF-Token",Utils.getCSRFToken()),n.onreadystatechange=function(){if(n.readyState>3){if(!1===Utils.handleHTTPError(n.status,!1))return!1;try{var e=JSON.parse(n.responseText);if("string"==typeof e.result&&"success"===e.result){var t=r+"ok";if("boolean"==typeof e.data.existing&&!1===e.data.existing)t=r+"error-1";else if("boolean"==typeof e.data.trusted&&!1===e.data.trusted)t=r+"error-2";document.getElementById(t).style.display="block","form-register-email-validation-"===r&&UI.form.resetRegistrationSize()}}catch(e){console.log(e)}}},n.send("email="+encodeURIComponent(e.target.value))}},testPassword:function(e){var t=!1,r=document.getElementById("user-edit-password-progress");if(!(null===r&&(t=!0,null===(r=document.getElementById("form-register-password-progress")))||(r.style.display="none",r.setAttribute("display","ok"),r.title="Your password seems to be strong!",r.querySelector("div").style.width="0%",!0===t&&UI.form.resetRegistrationSize(),""===e.target.value||e.target.value.length>30))){var n=Utils.makeConnection();n.open("POST","/validatePassword",!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.setRequestHeader("X-CSRF-Token",Utils.getCSRFToken()),n.onreadystatechange=function(){if(n.readyState>3){if(!1===Utils.handleHTTPError(n.status,!1))return!1;try{var e=JSON.parse(n.responseText);"string"==typeof e.result&&"success"===e.result&&"number"==typeof e.data.score&&(e.data.score<40?(r.setAttribute("display","error"),r.title="Your password is weak, we will accept it anyway, but consider using a better password."):e.data.score<75&&(r.setAttribute("display","warn"),r.title="Your passord is strong enough, anyway you could improve it."),r.title=e.data.score+"/100 | "+r.title,r.querySelector("div").style.width=e.data.score+"%",r.style.display="block",!0===t&&UI.form.resetRegistrationSize())}catch(e){console.log(e)}}},n.send("password="+encodeURIComponent(e.target.value))}},logout:function(){var e=Utils.makeConnection();e.open("POST","/logout",!0),e.setRequestHeader("X-CSRF-Token",Utils.getCSRFToken()),e.onreadystatechange=function(){if(e.readyState>3){if(!1===Utils.handleHTTPError(e.status,!1))return!1;try{var t=JSON.parse(e.responseText);return"string"!=typeof t.result||"success"!==t.result?UI.alert.show("An unexpected error has occurred, please retry later.","Unable to complete the action.","error"):UI.alert.show("See you soon!","Good bye!","success",function(){window.location.href="/"})}catch(e){return console.log(e),UI.alert.show("An unexpected error has occurred, please retry later.","Unable to complete the action.","error")}}},e.send()},restorePassword:function(){var e=document.getElementById("form-login-email").value;if(""===e||e.length>256)return UI.alert.show("You must provide a valid e-mail address.","Invalid e-mail address.","error");var t=Utils.makeConnection();t.open("POST","/user/sendPasswordRestoreRequest",!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.setRequestHeader("X-CSRF-Token",Utils.getCSRFToken()),t.onreadystatechange=function(){if(t.readyState>3){if(!1===Utils.handleHTTPError(t.status,!1))return!1;try{var e=JSON.parse(t.responseText);return"string"!=typeof e.result||"success"!==e.result?"number"==typeof e.code&&1===ata.code?UI.alert.show("You must provide a valid e-mail address.","Invalid e-mail address.","error"):UI.alert.show("An unexpected error has occurred, please retry later.","Unable to complete the action.","error"):UI.alert.show("An e-mail with restore instructions has been sent to you.","Request sent!","success")}catch(e){return console.log(e),UI.alert.show("An unexpected error has occurred, please retry later.","Unable to complete the action.","error")}}},t.send("email="+encodeURIComponent(e))}},loadUsers:function(){var e=new UI.dataContainer;e.loader=document.getElementById("users-loader"),e.error=document.getElementById("users-error"),e.list=document.getElementById("users-list");var t=1!==this.page;if(!0===t&&null!==e.list.querySelector("li.users-list-element-loader")){var r=e.list.querySelector("li.users-list-element-loader"),n=document.createElement("div");n.className="users-list-element-loader-spinner users-element-loader-spinner common-spinner",n.title="Loading users...",r.innerHTML="",r.appendChild(n)}else e.showLoader();var o=Utils.makeConnection();o.open("GET","/users/list?page="+this.page.toString(),!0),o.setRequestHeader("X-CSRF-Token",Utils.getCSRFToken()),o.onreadystatechange=function(){if(o.readyState>3){if(!1===Utils.handleHTTPError(o.status,!0,!0))return e.showError();try{var r=JSON.parse(o.responseText);if("string"!=typeof r.result||"success"!==r.result)return e.showError();if(null!==(n=e.list.querySelector("li.users-list-element-loader"))&&n.parentNode.removeChild(n),User.parseUsers(r.data,t),!0===t||r.data.length>0){var n;if((n=document.createElement("li")).className="users-list-element-loader users-element-loader",n.innerHTML="",12===r.data.length){var a=document.createElement("a");a.className="users-list-element-loader-link users-element-loader-link common-text",a.textContent="Load more users",a.title="Load more users",a.href="javascript:void(0);",a.onclick=User.loadMoreUsers,n.appendChild(a)}else if(!0===t){var s=document.createElement("span");s.className="users-list-element-loader-text users-element-loader-text common-text",s.textContent="No more users",n.appendChild(s)}e.list.appendChild(n)}e.showList()}catch(t){return console.log(t),e.showError()}}},o.send()},loadMoreUsers:function(){var e=document.getElementById("users-list").querySelector("li.users-list-element-loader");null!==e&&(e.innerHTML=""),User.page++,User.loadUsers()},parseUsers:function(e,t){var r=document.getElementById("users-list");if(!1===t&&(r.innerHTML="",0===e.length))return(o=document.createElement("li")).className="users-list-element-empty users-element-empty common-text",o.textContent="No user found.",void r.appendChild(o);for(var n=0;n<e.length;n++){var o;e[n].name=""===e[n].name||""===e[n].surname?e[n].name+e[n].surname:e[n].name+" "+e[n].surname,(o=document.createElement("li")).className="users-list-element users-element",o.setAttribute("uid",e[n].id.toString());var a=document.createElement("a");a.className="users-list-element-name users-element-name common-text",a.textContent=e[n].name,a.title=e[n].name,a.href="/user/"+e[n].id.toString(),o.appendChild(a);var s=document.createElement("p");if(s.className="users-list-element-email users-element-email common-text",s.textContent=e[n].email,o.appendChild(s),!0===e[n].admin){var l=document.createElement("div");l.className="users-list-element-admin-badge users-element-admin-badge common-text",l.textContent="Admin",o.appendChild(l)}var i,d=document.createElement("p");if(d.className="users-list-element-date users-element-date common-text",d.textContent="Member since: "+new Date(1e3*e[n].date).toLocaleDateString("en",{year:"numeric",month:"long",day:"numeric"}),o.appendChild(d),(i=document.createElement("button")).className="users-list-element-button users-element-button common-text",i.style.marginLeft="0px",i.title="Delete",i.textContent="Delete",i.onclick=User.deleteUser,o.appendChild(i),(i=document.createElement("button")).className="users-list-element-button users-element-button common-text",i.title="Delete and remove contents",i.textContent="Delete and remove contents",i.onclick=User.deleteUserAndContents,o.appendChild(i),!1===e[n].me)(i=document.createElement("button")).className="users-list-element-button users-element-button common-text",i.setAttribute("role","rights"),!0===e[n].admin?(i.title="Revert to normal user",i.textContent="Revert to normal user",i.onclick=User.dropAdminRights):(i.title="Promote to admin",i.textContent="Promote to admin",i.onclick=User.setAdminRights),o.appendChild(i);r.appendChild(o)}},deleteUserAndContents:function(e){if(null===e)return User.deleteUser(document.getElementById("user-id").value,!0);User.deleteUser(e,!0)},deleteUser:function(e,t){null===e&&(e=document.getElementById("user-id").value);var r="/users/"+("string"==typeof e?encodeURIComponent(e):encodeURIComponent(e.target.parentNode.getAttribute("uid")));if(!1!==window.confirm("Do you really want to remove the user? Note that this action is irreversible.")){!0===t&&(r+="?dropContents=1");var n=Utils.makeConnection();n.open("DELETE",r,!0),n.setRequestHeader("X-CSRF-Token",Utils.getCSRFToken()),n.onreadystatechange=function(){if(n.readyState>3){if(!1===Utils.handleHTTPError(n.status,!0,!0))return!1;try{var t=JSON.parse(n.responseText);if("string"!=typeof t.result||"success"!==t.result)return"number"==typeof t.code&&1===t.code?UI.alert.show("there must be at least one admin user.","Cannot remove this user.","error"):UI.alert.show("An unexpected error has occurred, please retry later.","Unable to complete the action.","error");if("string"==typeof e)return UI.alert.show("This user is no longer registered to the website.","User removed.","success",function(){window.location.href="/"});var r=e.target.parentNode,o=document.getElementById("users-list");if(o.removeChild(r),null===o.querySelector("li.users-list-element")){if(null!==o.querySelector("li.users-list-element-loader-link"))return User.loadMoreUsers();o.innerHTML="",(r=document.createElement("li")).className="users-list-element-empty dashboard-element-empty common-text",r.textContent="No user found.",o.appendChild(r)}return UI.alert.show("This user is no longer registered to the website.","User removed.","success")}catch(e){return console.log(e),UI.alert.show("An unexpected error has occurred, please retry later.","Unable to complete the action.","error")}}},n.send()}},dropAdminRights:function(e){!0===window.confirm("Do you really want to revert this user to a normal user? Note that all memes created by this user will be removed.")&&User.setAdminRights(e,!1)},setAdminRights:function(e,t){if(!1===t||!1!==window.confirm("Do you really want to promote this user to admin?")){var r="/users/"+encodeURIComponent(e.target.parentNode.getAttribute("uid"))+"/setAdminRights?value="+(!1===t?"0":"1"),n=Utils.makeConnection();n.open("GET",r,!0),n.setRequestHeader("X-CSRF-Token",Utils.getCSRFToken()),n.onreadystatechange=function(){if(n.readyState>3){if(!1===Utils.handleHTTPError(n.status,!0,!0))return!1;try{var r=JSON.parse(n.responseText);if("string"!=typeof r.result||"success"!==r.result)return UI.alert.show("An unexpected error has occurred, please retry later.","Unable to complete the action.","error");var o=e.target.parentNode,a=o.querySelector('.users-list-element-button[role="rights"]');if(!1===t){null!==(s=o.querySelector(".users-list-element-admin-badge"))&&s.parentNode.removeChild(s),a.title="Promote to admin",a.textContent="Promote to admin",a.onclick=User.setAdminRights}else{var s,l=o.querySelector(".users-list-element-email");(s=document.createElement("div")).className="users-list-element-admin-badge users-element-admin-badge common-text",s.textContent="Admin",l.parentNode.insertBefore(s,l.nextSibling),a.title="Revert to normal user",a.textContent="Revert to normal user",a.onclick=User.dropAdminRights}return UI.alert.show(!1===t?"This user is now a regular user.":"This user is now an admin.","User rights changed successfully!","success")}catch(e){return console.log(e),UI.alert.show("An unexpected error has occurred, please retry later.","Unable to complete the action.","error")}}},n.send()}},adminLoggedIn:function(){var e=document.getElementById("auth-admin");return null!==e&&"1"===e.value},revertChanges:function(e){e.preventDefault(),e.stopPropagation(),document.getElementById("user-edit-input-name").value=document.getElementById("user-edit-input-name-old").value,document.getElementById("user-edit-input-surname").value=document.getElementById("user-edit-input-surname-old").value,document.getElementById("user-edit-input-email").value=document.getElementById("user-edit-input-email-old").value},saveChanges:function(e){e.preventDefault(),e.stopPropagation();var t=document.getElementById("user-edit-input-name").value;if(""===t||t.length>30)return UI.alert.show("You must provide a name, max length is 30 chars.","Invalid name.","error");var r=document.getElementById("user-edit-input-surname").value;if(""===r||r.length>30)return UI.alert.show("You must provide a surname, max length is 30 chars.","Invalid surname.","error");var n=document.getElementById("user-edit-input-email").value;if(""===n||n.length>256)return UI.alert.show("You must provide a valid e-mail address.","Invalid e-mail address.","error");var o=Utils.makeConnection();o.open("PATCH",document.getElementById("user-password-change").action,!0),o.setRequestHeader("X-CSRF-Token",Utils.getCSRFToken()),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){if(o.readyState>3){if(!1===Utils.handleHTTPError(o.status,!0,!0))return!1;try{var e=JSON.parse(o.responseText);if("string"!=typeof e.result||"success"!==e.result){switch("number"!=typeof e.code?null:e.code){case 1:case 2:return UI.alert.show("You must provide a name, max length is 30 chars.","Invalid name.","error");case 3:case 4:return UI.alert.show("You must provide a surname, max length is 30 chars.","Invalid surname.","error");case 5:return UI.alert.show("You must provide a valid e-mail address.","Invalid e-mail address.","error")}return UI.alert.show("An unexpected error has occurred, please retry later.","Unable to complete the action.","error")}return document.getElementById("user-edit-input-name").value=t,document.getElementById("user-edit-input-name-old").value=t,document.getElementById("user-edit-input-surname").value=r,document.getElementById("user-edit-input-surname-old").value=r,document.getElementById("user-edit-input-email").value=n,document.getElementById("user-edit-input-email-old").value=n,UI.alert.show("All changes have been saved.","Changes saved.","success")}catch(e){return console.log(e),UI.alert.show("An unexpected error has occurred, please retry later.","Unable to complete the action.","error")}}},o.send("name="+encodeURIComponent(t)+"&surname="+encodeURIComponent(r)+"&email="+encodeURIComponent(n)+"&mode=1")},changePassword:function(e){e.preventDefault(),e.stopPropagation();var t=document.getElementById("user-edit-input-password-old").value;if(""===t||t.length>30)return UI.alert.show("You must provide a password, max length is 30 chars.","Current password is not valid.","error");var r=document.getElementById("user-edit-input-password").value;if(""===r||r.length>30)return UI.alert.show("You must provide a password, max length is 30 chars.","New password is not valid.","error");if(r!==document.getElementById("user-edit-input-password-confirm").value)return UI.alert.show("Please double check the inserted passwords.","The inserted passwords don't match.","error");var n=Utils.makeConnection();n.open("PATCH",document.getElementById("user-password-change").action,!0),n.setRequestHeader("X-CSRF-Token",Utils.getCSRFToken()),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(n.readyState>3){if(!1===Utils.handleHTTPError(n.status,!0,!0))return!1;try{var e=JSON.parse(n.responseText);if("string"!=typeof e.result||"success"!==e.result){switch("number"!=typeof e.code?null:e.code){case 8:case 9:return UI.alert.show("You must provide a password, max length is 30 chars.","Current password is not valid.","error");case 10:return UI.alert.show("You must provide a password, max length is 30 chars.","New password is not valid.","error");case 12:return UI.alert.show("If you forgot your password, restore it in the login.","Current password is not correct.","error")}return UI.alert.show("An unexpected error has occurred, please retry later.","Unable to complete the action.","error")}document.getElementById("user-edit-input-password-old").value="",document.getElementById("user-edit-input-password").value="",document.getElementById("user-edit-input-password-confirm").value="",alert("The password has been updated.")}catch(e){return console.log(e),UI.alert.show("An unexpected error has occurred, please retry later.","Unable to complete the action.","error")}}},n.send("old_password="+encodeURIComponent(t)+"&password="+encodeURIComponent(r)+"&mode=2")},restorePassword:function(e){e.preventDefault(),e.stopPropagation();var t=document.getElementById("password-restore-password").value;if(""===t||t.length>30)return UI.alert.show("You must provide a password, max length is 30 chars.","Invalid password.","error");if(document.getElementById("password-restore-confirm").value!==t)return UI.alert.show("Please double check the inserted passwords.","The inserted passwords don't match.","error");var r=document.getElementById("password-restore-token").value,n=document.getElementById("password-restore-email").value,o=Utils.makeConnection();o.open("PATCH",document.getElementById("password-restore").action,!0),o.setRequestHeader("X-CSRF-Token",Utils.getCSRFToken()),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){if(o.readyState>3){if(!1===Utils.handleHTTPError(o.status,!1))return!1;try{var e=JSON.parse(o.responseText);if("string"!=typeof e.result||"success"!==e.result){switch("number"==typeof e.code?e.code:null){case 4:case 5:return UI.alert.show("You must provide a password, max length is 30 chars.","Invalid password.","error")}return UI.alert.show("An unexpected error has occurred, please retry later.","Unable to complete the action.","error")}return UI.alert.show("Your password has been updated.","Passowrd changed!","success",function(){window.location.href="/"})}catch(e){return console.log(e),UI.alert.show("An unexpected error has occurred, please retry later.","Unable to complete the action.","error")}}},o.send("password="+encodeURIComponent(t)+"&token="+encodeURIComponent(r)+"&email="+encodeURIComponent(n))}},MEME={page:1,file:null,mode:null,ordering:"popular",getMEMEs:function(e){switch("string"!=typeof e&&(e=MEME.mode),MEME.mode=e,"#new"===window.location.hash&&(MEME.ordering="new"),e){case"search":document.getElementById("dashboard-search-stats").style.display="none";var t=document.getElementById("dashboard-search-input").value;if(""===t&&(null===(t=Utils.getParam("q"))||""===t))return;var r="/memes?page="+this.page.toString()+"&q="+encodeURIComponent(t)+"&mode=search&ordering="+encodeURIComponent(MEME.ordering);break;case"author":r="/memes?page="+this.page.toString()+"&author="+encodeURIComponent(document.getElementById("dashboard-author").value)+"&mode=author&ordering="+encodeURIComponent(MEME.ordering);break;case"category":r="/memes?page="+this.page.toString()+"&category="+encodeURIComponent(document.getElementById("dashboard-category").value)+"&mode=category&ordering="+encodeURIComponent(MEME.ordering);break;case"categories":r="/categories/list?page="+this.page.toString();break;default:r="/memes?page="+this.page.toString()+"&mode=dashboard&ordering="+encodeURIComponent(MEME.ordering)}var n=new UI.dataContainer;n.loader=document.getElementById("dashboard-loader"),n.error=document.getElementById("dashboard-error"),n.list=document.getElementById("dashboard-list");var o=1!==this.page;if(!0===o&&null!==n.list.querySelector("li.dashboard-list-element-loader")){var a=n.list.querySelector("li.dashboard-list-element-loader"),s=document.createElement("div");s.className="dashboard-list-element-loader-spinner dashboard-element-loader-spinner common-spinner",s.title="categories"===e?"Loading categories...":"Loading memes...",a.innerHTML="",a.appendChild(s)}else n.showLoader();var l=Utils.makeConnection();l.open("GET",r,!0),l.setRequestHeader("X-CSRF-Token",Utils.getCSRFToken()),l.onreadystatechange=function(){if(l.readyState>3){if(!1===Utils.handleHTTPError(l.status,!1))return n.showError();try{var t=JSON.parse(l.responseText);if("string"!=typeof t.result||"success"!==t.result)return n.showError();if(null!==(a=n.list.querySelector("li.dashboard-list-element-loader"))&&a.parentNode.removeChild(a),"search"===e){var r=document.getElementById("dashboard-search-stats");r.textContent="Found "+Utils.stringifyCounterValue(t.data.count)+" elements in "+(Math.round(100*t.data.time)/100).toString(),r.style.display="block",MEME.parseMEMEs(t.data.elements,o,!1)}else MEME.parseMEMEs(t.data,o,"categories"===e);if(!0===o||t.data.length>0){var a,s;if((a=document.createElement("li")).className="dashboard-list-element-loader dashboard-element-loader",a.innerHTML="",12===t.data.length)(s=document.createElement("a")).className="dashboard-list-element-loader-link dashboard-element-loader-link common-text",s.textContent="categories"===e?"Load more categories":"Load more memes",s.title="categories"===e?"Load more categories":"Load more memes",s.href="javascript:void(0);",s.onclick=MEME.loadMoreMEMEs,a.appendChild(s);else if(!0===o){var i=document.createElement("span");i.className="dashboard-list-element-loader-text dashboard-element-loader-text common-text",i.textContent="categories"===e?"No more categories":"No more memes",a.appendChild(i)}n.list.appendChild(a)}if("category"===e&&!1===o&&0===t.data.length)(s=document.createElement("button")).className="dashboard-list-element-category-remove dashboard-category-remove common-text",s.title="Remove this category",s.textContent="Remove this category",s.onclick=MEME.removeCategory,n.list.appendChild(s);return n.showList(!0)}catch(e){return console.log(e),n.showError()}}},l.send()},loadMoreMEMEs:function(){var e=document.getElementById("dashboard-list").querySelector("li.dashboard-list-element-loader");null!==e&&(e.innerHTML=""),MEME.page++,MEME.getMEMEs()},setOrdering:function(e){var t="string"==typeof e?e:e.target.getAttribute("ord");"new"!==t&&"popular"!==t||t===MEME.ordering||("new"===t?(document.querySelector('.dashboard-ordering-list-element-link[ord="new"]').setAttribute("selected","true"),document.querySelector('.dashboard-ordering-list-element-link[ord="popular"]').setAttribute("selected","false"),window.location.hash="#new"):(document.querySelector('.dashboard-ordering-list-element-link[ord="popular"]').setAttribute("selected","true"),document.querySelector('.dashboard-ordering-list-element-link[ord="new"]').setAttribute("selected","false"),window.location.hash="#popular"),MEME.ordering=t,MEME.page=1,MEME.getMEMEs(),document.getElementById("dashboard-list").innerHTML="")},search:function(e){"object"==typeof e&&(e.preventDefault(),e.stopPropagation()),MEME.page=1,MEME.getMEMEs("search")},parseMEMEs:function(e,t,r){var n=document.getElementById("dashboard-list");if(!1===t&&(n.innerHTML="",0===e.length))return(a=document.createElement("li")).className="dashboard-list-element-empty dashboard-element-empty common-text",a.textContent=!0===r?"No category found.":"No meme found.",void n.appendChild(a);for(var o=0;o<e.length;o++){var a;(a=document.createElement("li")).className="dashboard-list-element dashboard-element",a.setAttribute("mid",!0===r?e[o].meme.id.toString():e[o].id.toString());var s=document.createElement("div");if(s.className="dashboard-list-element-container dashboard-element-container",!0!==r&&void 0!==e[o].mine&&!0===e[o].mine){var l=document.createElement("div");l.className="dashboard-list-element-container-remove dashboard-element-remove",l.setAttribute("scope","remove"),l.title="Remove this meme.",l.onclick=MEME.remove,s.appendChild(l)}var i=!0===r?e[o].meme.title:e[o].title;(w=document.createElement("a")).className="dashboard-list-element-container-link-null",w.title=i,w.href=!0===r?"/category/"+encodeURIComponent(e[o].name):"/memes/"+encodeURIComponent(e[o].id);var d=!0===r?e[o].meme.path:e[o].path;if(0!==d.indexOf("http")&&(d="/"+d),3===(!0===r?e[o].meme.type:e[o].type)){var c=document.createElement("div");c.className="dashboard-list-element-container-video dashboard-element-video",c.setAttribute("ratio",!0===r?e[o].meme.ratio:e[o].ratio);var m=document.createElement("video");m.className="dashboard-list-element-container-video-player",m.src=d,m.controls="true",c.appendChild(m),w.appendChild(c)}else{var u=document.createElement("div");u.className="dashboard-list-element-container-image dashboard-element-image",u.setAttribute("ratio",!0===r?e[o].meme.ratio:e[o].ratio),u.style.backgroundImage="url("+d+")",w.appendChild(u)}if(s.appendChild(w),!0!==r){var p=document.createElement("div");p.className="dashboard-list-element-container-info dashboard-element-info";var h=document.createElement("p");h.className="dashboard-list-element-container-info-date dashboard-element-date common-text",h.textContent=new Date(1e3*e[o].date).toLocaleDateString("en",{year:"numeric",month:"long",day:"numeric"}),p.appendChild(h);var g=document.createElement("a");if(g.className="dashboard-list-element-container-info-title dashboard-element-title common-text",g.textContent=i,g.title=i,g.href=!0===r?"/category/"+encodeURIComponent(e[o].name):"/memes/"+encodeURIComponent(e[o].id),p.appendChild(g),!1===r&&null!==e[o].user){var y=document.createElement("a");y.className="dashboard-list-element-container-info-user dashboard-element-user common-text",y.href="/author/"+encodeURIComponent(e[o].user.id),y.title="Check more memes from this user.",y.textContent=e[o].user.name,p.appendChild(y)}if(!1===r){var f=document.createElement("ul");f.className="dashboard-list-element-container-info-categories dashboard-element-categories";for(var v=0;v<e[o].categories.length;v++){var w,E=document.createElement("li");E.className="dashboard-list-element-container-info-categories-element dashboard-element-category",(w=document.createElement("a")).className="dashboard-list-element-container-info-categories-element-link dashboard-element-category-name common-text",w.textContent=e[o].categories[v],w.href="/category/"+encodeURIComponent(e[o].categories[v]),w.title="More meme from this category.",E.appendChild(w),f.appendChild(E)}p.appendChild(f);var I,b=document.createElement("div");b.className="dashboard-element-counters",(I=document.createElement("div")).className="dashboard-list-element-container-info-icon dashboard-element-icon",I.setAttribute("scope","upVote"),I.onclick=Vote.toggleUpVote,!0===e[o].vote.positive&&I.setAttribute("selected","true"),b.appendChild(I),(C=document.createElement("span")).className="dashboard-list-element-container-info-counter dashboard-element-counter common-text",C.textContent=Utils.stringifyCounterValue(e[o].counters.upVotes),C.setAttribute("scope","upVote"),C.setAttribute("counter",e[o].counters.upVotes.toString()),b.appendChild(C),(I=document.createElement("div")).className="dashboard-list-element-container-info-icon dashboard-element-icon",I.setAttribute("scope","downVote"),I.onclick=Vote.toggleDownVote,!0===e[o].vote.negative&&I.setAttribute("selected","true"),b.appendChild(I),(C=document.createElement("span")).className="dashboard-list-element-container-info-counter dashboard-element-counter common-text",C.textContent=Utils.stringifyCounterValue(e[o].counters.downVotes),C.setAttribute("scope","downVote"),C.setAttribute("counter",e[o].counters.downVotes.toString()),b.appendChild(C),(I=document.createElement("div")).className="dashboard-list-element-container-info-icon dashboard-element-icon",I.setAttribute("scope","comment"),b.appendChild(I),(C=document.createElement("span")).className="dashboard-list-element-container-info-counter dashboard-element-counter common-text",C.textContent=Utils.stringifyCounterValue(e[o].counters.comments),C.setAttribute("counter",e[o].counters.comments.toString()),b.appendChild(C),p.appendChild(b)}s.appendChild(p),a.appendChild(s),n.appendChild(a)}else{a.setAttribute("cid",e[o].id.toString());var C,U=document.createElement("a");U.className="dashboard-list-element-container-link dashboard-element-link common-text",U.title=e[o].name,U.textContent=e[o].name,U.href="/category/"+encodeURIComponent(e[o].name),s.appendChild(U),(C=document.createElement("p")).className="dashboard-list-element-container-counter dashboard-element-counter common-text",C.textContent=Utils.stringifyCounterValue(e[o].count)+" MEMEs in this category.",s.appendChild(C),a.appendChild(s),n.appendChild(a)}}},loadTrends:function(){var e=new UI.dataContainer;e.loader=document.getElementById("dashboard-trends-loader"),e.error=document.getElementById("dashboard-trends-error"),e.list=document.getElementById("dashboard-trends-list"),e.showLoader();var t=Utils.makeConnection();t.open("GET","/trends",!0),t.setRequestHeader("X-CSRF-Token",Utils.getCSRFToken()),t.onreadystatechange=function(){if(t.readyState>3){if(!1===Utils.handleHTTPError(t.status,!1))return e.showError();try{var r=JSON.parse(t.responseText);if("string"!=typeof r.result||"success"!==r.result)return e.showError();if(0===r.data.length)return(o=document.createElement("li")).className="dashboard-trends-list-element-empty dashboard-trends-element-empty common-text",o.textContent="No trend found.",e.list.appendChild(o),e.showList();for(var n=0;n<r.data.length;n++){var o;(o=document.createElement("li")).className="dashboard-trends-list-element dashboard-trends-element";var a=document.createElement("a");a.className="dashboard-trends-list-element-link dashboard-trends-element-link common-text",a.textContent=r.data[n].name+" ("+Utils.stringifyCounterValue(r.data[n].count)+")",a.title=r.data[n].name,a.href="/category/"+encodeURIComponent(r.data[n].name),o.appendChild(a),e.list.appendChild(o)}return e.showList()}catch(t){return console.log(t),e.showError()}}},t.send()},showCategories:function(){window.location.href="/categories"},dragOverUploader:function(e){e.preventDefault(),e.stopPropagation(),null===MEME.file&&document.getElementById("create-uploader").setAttribute("drag","true")},dragLeaveUploader:function(e){e.preventDefault(),e.stopPropagation(),null===MEME.file&&document.getElementById("create-uploader").setAttribute("drag","false")},setUploaderFile:function(e){if(e.preventDefault(),e.stopPropagation(),null===MEME.file){if("drop"===e.type){var t=void 0!==e.dataTransfer?e.dataTransfer:void 0===e.originalEvent.dataTransfer?null:e.originalEvent.dataTransfer;if(null===t||void 0===t.files||0===t.files.length)return;var r=(o=t.files[0]).type.toLowerCase()}else{var n=document.getElementById("create-uploader-input").files;if(0===n.length)return;r=n[0].type.toLowerCase();var o=n[0]}if(["image/jpeg","image/jpg","image/png","image/gif","video/mp4"].indexOf(r)<0)document.getElementById("create-uploader-input").value="";else if(MEME.file=o,document.getElementById("create-uploader").setAttribute("drag","completed"),document.getElementById("create-uploader-inner-content-wrapper-picker").style.display="none",document.getElementById("create-uploader-inner-content-wrapper-preview").style.display="table-cell","video/mp4"===r){document.getElementById("create-uploader-inner-content-wrapper-preview-video").style.display="none",document.getElementById("create-uploader-inner-content-wrapper-preview-loader").style.display="block";var a=document.getElementById("create-uploader-inner-content-wrapper-preview-video-player");a.src=window.URL.createObjectURL(MEME.file),a.load()}else{var s=document.getElementById("create-uploader-inner-content-wrapper-preview-image");s.style.backgroundImage="url("+window.URL.createObjectURL(o)+")",s.style.display="block"}}},processVideoPreview:function(e,t){document.getElementById("create-uploader-inner-content-wrapper-preview-loader").style.display="none",document.getElementById("create-uploader-inner-content-wrapper-preview-image").style.display="none",document.getElementById("create-uploader-inner-content-wrapper-preview-video").style.display="block";var r=document.getElementById("create-uploader-inner-content-wrapper-preview-video-player");if(!1!==e){var n=parseInt(document.getElementById("video-max-length").value);if(n<=0||!0===isNaN(n))return MEME.removeFileFromUploader();if(r.duration>n)return alert("The length of your video is too much."),MEME.removeFileFromUploader()}"string"!=typeof t&&(t=document.getElementById("create-container-section-form-ratio").value),(t=t.split(":"))[0]=parseInt(t[0]),t[1]=parseInt(t[1]),r.style.height="auto",r.style.width="auto",r.style.top="0px",r.style.left="0px",r.videoWidth/r.videoHeight>t[0]/t[1]?(r.style.height="100%",r.style.width="auto",window.setTimeout(function(){var e=parseFloat(window.getComputedStyle(document.getElementById("create-uploader-inner-content-wrapper-preview-video")).width),t=(parseFloat(window.getComputedStyle(r).width)-e)/2;r.style.left="-"+t.toString()+"px"},25)):(r.style.width="100%",r.style.height="auto",window.setTimeout(function(){var e=parseFloat(window.getComputedStyle(document.getElementById("create-uploader-inner-content-wrapper-preview-video")).height),t=(parseFloat(window.getComputedStyle(r).height)-e)/2;r.style.top="-"+t.toString()+"px"},25))},playVideoPreview:function(e){var t=document.getElementById("create-uploader-inner-content-wrapper-preview-video-player");return!0===e||!0===t.ended?(t.currentTime=0,t.play()):!0===t.paused?t.play():void t.pause()},openFilePicker:function(){null===MEME.file&&document.getElementById("create-uploader-input").click()},removeFileFromUploader:function(){MEME.file=null,document.getElementById("create-uploader-input").value="",document.getElementById("create-uploader-inner-content-wrapper-preview").style.display="none",document.getElementById("create-uploader-inner-content-wrapper-picker").style.display="table-cell";var e=document.getElementById("create-uploader-inner-content-wrapper-preview-image");e.style.backgroundImage="",e.style.display="none",document.getElementById("create-uploader-inner-content-wrapper-preview-video").style.display="none";var t=document.getElementById("create-uploader-inner-content-wrapper-preview-video-player");try{t.pause(),t.src="",t.load()}catch(e){}t.style.left="0px",t.style.top="0px",document.getElementById("create-uploader-inner-content-wrapper-preview-loader").style.display="none",document.getElementById("create-uploader").setAttribute("drag","false")},setRatio:function(){var e=document.getElementById("create-container-section-form-ratio").value;document.getElementById("create-uploader-inner-content-wrapper-preview-image").setAttribute("ratio",e),document.getElementById("create-uploader-inner-content-wrapper-preview-video").setAttribute("ratio",e),null!==MEME.file&&"video/mp4"===MEME.file.type.toLowerCase()&&MEME.processVideoPreview(!1,e)},addCategory:function(e){if(13===e.keyCode&&(e.preventDefault(),e.stopPropagation(),""!==e.target.value&&e.target.value.length<=16)){for(var t=document.getElementById("create-container-section-form-category"),r=t.querySelectorAll("option"),n=e.target.value.trim(),o=0;o<r.length;o++)if(r.item(o).textContent===n)return r.item(o).selected=!0,void(e.target.value="");var a=document.createElement("option");a.className="common-text",a.value="",a.textContent=n,a.selected=!0,t.appendChild(a),e.target.value="",t.scrollTop=t.scrollHeight}},triggerCreation:function(e){e.preventDefault(),e.stopPropagation(),MEME.create()},create:function(){if(null===MEME.file)return UI.alert.show("A MEME must contain a file (an image, GIF or a video).","You must provide a file.","error");var e=new FormData,t=document.getElementById("create-container-section-form-title").value;if(""===t||t.length>30)return UI.alert.show("You must provide a title, max length is 30 chars.","Invalid title.","error");e.append("title",t);for(var r=document.getElementById("create-container-section-form-category").querySelectorAll("option"),n=0,o=0;o<r.length;o++)!0===r.item(o).selected&&(""===r.item(o).value?e.append("new_category[]",r.item(o).textContent):e.append("category[]",r.item(o).value),n++);if(0===n)return UI.alert.show("You must select at least one category.","Invalid categories.","error");if(n>3)return UI.alert.show("You can select up to 3 categories.","Invalid categories.","error");var a=document.getElementById("create-container-section-form-text").value;if(a.length>1e3)return UI.alert.show("The given text is too long, max length is 1000 chars.","Invalid text.","error");e.append("text",a);var s=document.getElementById("create-container-section-form-ratio").value;e.append("ratio","4:3"!==s&&"16:9"!==s&&"16:10"!==s?"1:1":s),e.append("file",MEME.file),document.getElementById("create-loader-action-processing").style.display="none",document.getElementById("create-loader-action-uploading").style.display="block",document.getElementById("create-loader-progress").setAttribute("status","uploading"),document.getElementById("create-loader-progress-value").style.width="0%",document.getElementById("create-container").style.display="none",document.getElementById("create-loader").style.display="block";var l=Utils.makeConnection();l.upload.onprogress=function(e){if(!0===e.lengthComputable){var t=e.loaded/e.total*100;document.getElementById("create-loader-progress-value").style.width=t.toString()+"%",e.loaded===e.total&&(document.getElementById("create-loader-action-uploading").style.display="none",document.getElementById("create-loader-action-processing").style.display="block",document.getElementById("create-loader-progress").setAttribute("status","processing"))}},l.open("POST",document.getElementById("create-container-section-form").action,!0),l.setRequestHeader("X-CSRF-Token",Utils.getCSRFToken()),l.onreadystatechange=function(){if(l.readyState>3){if(MEME.hideCreationLoader(),!1===Utils.handleHTTPError(l.status,!0,!0))return!1;try{var e=JSON.parse(l.responseText);if("string"!=typeof e.result||"success"!==e.result){switch("number"!=typeof e.code?null:e.code){case 1:return UI.alert.show("A MEME must contain a file (an image, GIF or a video).","You must provide a file.","error");case 2:return UI.alert.show("File can be an image (jpg or png), a GIF or a mp4 video.","Unsupported file type.","error");case 3:case 4:return UI.alert.show("You must provide a title, max length is 30 chars.","Invalid title.","error");case 5:return UI.alert.show("You must select at least one category.","Invalid categories.","error");case 6:return UI.alert.show("You can select up to 3 categories.","Invalid categories.","error");case 8:return UI.alert.show("The given text is too long, max length is 1000 chars.","Invalid text.","error")}return UI.alert.show("An unexpected error has occurred, please retry later.","Unable to complete the action.","error")}var t="number"==typeof e.data.id?"/memes/"+e.data.id.toString():"/";return UI.alert.show("Your MEME has successfully been created!","MEME created!","success",function(){window.location.href=t})}catch(e){return console.log(e),UI.alert.show("An unexpected error has occurred, please retry later.","Unable to complete the action.","error")}}},l.send(e)},hideCreationLoader:function(){document.getElementById("create-loader").style.display="none",document.getElementById("create-container").style.display="block",document.getElementById("create-loader-progress").setAttribute("status","none"),document.getElementById("create-loader-progress-value").style.width="0%",document.getElementById("create-loader-action-uploading").style.display="none",document.getElementById("create-loader-action-processing").style.display="none"},remove:function(e){if(null===e)var t=document.getElementById("meme-id").value;else if(null===(t=e.target.parentNode.parentNode.getAttribute("mid")))return;if(!0===window.confirm("Do you really want to remove this MEME?")){var r=Utils.makeConnection();r.open("DELETE","/memes/"+encodeURIComponent(t),!0),r.setRequestHeader("X-CSRF-Token",Utils.getCSRFToken()),r.onreadystatechange=function(){if(r.readyState>3){if(!1===Utils.handleHTTPError(r.status,!0,!0))return!1;try{var t=JSON.parse(r.responseText);if("string"!=typeof t.result||"success"!==t.result)return UI.alert.show("An unexpected error has occurred, please retry later.","Unable to complete the action.","error");if(null===e)return UI.alert.show("This MEME has successfully been removed.","MEME removed.","success",function(){window.location.href="/"});var n=(o=e.target.parentNode.parentNode).parentNode;if(n.removeChild(o),null===n.querySelector("li.dashboard-list-element")){if(null!==n.querySelector("li.dashboard-list-element-loader-link"))return MEME.loadMoreMEMEs();var o;n.innerHTML="",(o=document.createElement("li")).className="dashboard-list-element-empty dashboard-element-empty common-text",o.textContent="No meme found.",n.appendChild(o)}}catch(e){return console.log(e),UI.alert.show("An unexpected error has occurred, please retry later.","Unable to complete the action.","error")}}},r.send()}},removeCategory:function(){var e=document.getElementById("dashboard-category").value,t=Utils.makeConnection();t.open("DELETE","/category/"+encodeURIComponent(e),!0),t.setRequestHeader("X-CSRF-Token",Utils.getCSRFToken()),t.onreadystatechange=function(){if(t.readyState>3){if(!1===Utils.handleHTTPError(t.status,!0,!0))return!1;try{var e=JSON.parse(t.responseText);return"string"!=typeof e.result||"success"!==e.result?"number"==typeof e.code&&3===e.code?UI.alert.show("You cannot remove a non-empty category.","Invalid action.","error"):UI.alert.show("An unexpected error has occurred, please retry later.","Unable to complete the action.","error"):UI.alert.show("This category has successfully been removed.","Category removed","success",function(){window.location.href="/"})}catch(e){return console.log(e),UI.alert.show("An unexpected error has occurred, please retry later.","Unable to complete the action.","error")}}},t.send()}},Comment={page:1,loadComments:function(){var e=new UI.dataContainer,t=document.getElementById("user-id"),r=null!==t;if(!0===r){e.loader=document.getElementById("user-comments-loader"),e.error=document.getElementById("user-comments-error"),e.list=document.getElementById("user-comments-list");var n=e.list.querySelector("li.user-comments-list-element-loader")}else{e.loader=document.getElementById("slide-column-comments-loader"),e.error=document.getElementById("slide-column-comments-error"),e.list=document.getElementById("slide-column-comments-list");n=e.list.querySelector("li.slide-column-comments-list-element-loader")}var o=1===this.page?0:1;if(1===o&&null!==n){var a=document.createElement("div");a.className=!0===r?"user-comments-list-element-loader-spinner user-comments-element-loader-spinner":"slide-column-comments-list-element-loader-spinner meme-comments-element-loader-spinner",a.title="Loading comments...",n.innerHTML="",n.appendChild(a)}else e.showLoader();var s=!0===r?"/user/"+encodeURIComponent(t.value)+"/comments?":"/comments?meme="+encodeURIComponent(document.getElementById("meme-id").value)+"&page="+this.page.toString(),l=Utils.makeConnection();l.open("GET",s,!0),l.setRequestHeader("X-CSRF-Token",Utils.getCSRFToken()),l.onreadystatechange=function(){if(l.readyState>3){if(!1===Utils.handleHTTPError(l.status,!1))return e.showError();try{var t=JSON.parse(l.responseText);if("string"!=typeof t.result||"success"!==t.result)return e.showError();var r=null!==document.getElementById("user-id");if(null!==(n=!0===r?e.list.querySelector("li.user-comments-list-element-loader"):e.list.querySelector("li.slide-column-comments-list-element-loader"))&&n.parentNode.removeChild(n),Comment.parseComments(t.data,o),1===o||t.data.length>0){var n;if((n=document.createElement("li")).className=!0===r?"user-comments-list-element-loader user-comments-element-loader":"slide-column-comments-list-element-loader meme-comments-element-loader",n.innerHTML="",20===t.data.length){var a=document.createElement("a");a.className=!0===r?"user-comments-list-element-loader-link user-comments-element-loader-link common-text":"slide-column-comments-list-element-loader-link meme-comments-element-loader-link common-text",a.textContent="Load more comments",a.title="Load more comments",a.href="javascript:void(0);",a.onclick=Comment.loadMoreComments,n.appendChild(a)}else if(1===o){var s=document.createElement("span");s.className=!0===r?"user-comments-list-element-loader-text user-comments-element-loader-text common-text":"slide-column-comments-list-element-loader-text meme-comments-element-loader-text common-text",s.textContent="No more comments",n.appendChild(s)}e.list.appendChild(n)}return e.showList()}catch(t){return console.log(t),e.showError()}}},l.send()},loadMoreComments:function(){if(null===document.getElementById("user-id"))var e=document.getElementById("slide-column-comments-list").querySelector("li.meme-comments-list-element-loader");else e=document.getElementById("user-comments-list").querySelector("li.user-comments-list-element-loader");null!==e&&(e.innerHTML=""),Comment.page++,Comment.loadComments()},parseComments:function(e,t){var r=null!==document.getElementById("user-id"),n=!0===r?document.getElementById("user-comments-list"):document.getElementById("slide-column-comments-list");if(0===t){if(n.innerHTML="",0===e.length)return(s=document.createElement("li")).className=!0===r?"user-comments-list-element-empty user-comments-element-empty common-text":"slide-column-comments-list-element-empty meme-comments-element-empty common-text",s.textContent="No comment found.",void n.appendChild(s)}else if(2===t){null!==(s=!0===r?n.querySelector(".user-comments-list-element-empty"):n.querySelector(".slide-column-comments-list-element-empty"))&&n.removeChild(s)}for(var o=User.adminLoggedIn(),a=0;a<e.length;a++){var s;(s=document.createElement("li")).className=!0===r?"user-comments-list-element user-comments-element":"slide-column-comments-list-element meme-comments-element",s.setAttribute("cid",e[a].id);var l,i=document.createElement("div");if(i.className=!0===r?"user-comments-list-element-header":"slide-column-comments-list-element-header","object"==typeof e[a].user&&null!==e[a].user)(l=document.createElement("a")).className=!0===r?"user-comments-list-element-header-user-link user-comments-element-user-link common-text":"slide-column-comments-list-element-header-user-link meme-comments-element-user-link common-text",l.title=e[a].user.name,l.textContent=e[a].user.name,l.href="/user/"+e[a].user.id;else(l=document.createElement("p")).className=!0===r?"user-comments-list-element-header-user user-comments-element-user common-text":"slide-column-comments-list-element-header-user meme-comments-element-user common-text",l.textContent="Anonymous user.";i.appendChild(l);var d=document.createElement("p");if(d.className=!0===r?"user-comments-list-element-header-date user-comments-element-date common-text":"slide-column-comments-list-element-header-date meme-comments-element-date common-text",d.textContent=new Date(1e3*e[a].date).toLocaleDateString("en",{year:"numeric",month:"long",day:"numeric"}),i.appendChild(d),!0===o||!0===e[a].mine){var c=document.createElement("div");c.className=!0===r?"user-comments-list-element-header-remove user-comments-element-remove":"slide-column-comments-list-element-header-remove meme-comments-element-remove",c.setAttribute("scope","remove"),c.title="Remove this comment",c.onclick=Comment.remove,i.appendChild(c)}s.appendChild(i);var m=document.createElement("p");m.className=!0===r?"user-comments-list-element-text user-comments-element-text common-text":"slide-column-comments-list-element-text meme-comments-element-text common-text",m.textContent=e[a].text,s.appendChild(m),2===t&&!1===r?n.insertBefore(s,n.firstChild):n.appendChild(s)}},triggerCreation:function(e){e.preventDefault(),e.stopPropagation(),Comment.create()},handleKeyPress:function(e){13===e.keyCode&&!0!==e.shiftKey&&(e.preventDefault(),e.stopPropagation(),Comment.create())},create:function(){var e=document.getElementById("slide-column-comments-editor-comment").value;if(0!==(e=e.trim()).length){if(e.length>1e4)return UI.alert.show("Your comment is too long, max length is 10000 chars.","Comment is too long.","error");var t=Utils.makeConnection();t.open("POST","/comments",!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.setRequestHeader("X-CSRF-Token",Utils.getCSRFToken()),t.onreadystatechange=function(){if(t.readyState>3){if(!1===Utils.handleHTTPError(t.status,!1))return!1;try{var e=JSON.parse(t.responseText);if("string"!=typeof e.result||"success"!==e.result){switch("number"==typeof e.code?e.code:null){case 1:return UI.alert.show("You cannot create an empty comment.","Invalid text.","error");case 2:return UI.alert.show("Your comment is too long, max length is 10000 chars.","Comment is too long.","error")}return UI.alert.show("An unexpected error has occurred, please retry later.","Unable to complete the action.","error")}document.getElementById("slide-column-comments-editor-comment").value="";var r=document.querySelector('.slide-column-counters-list-element-counter[scope="comment"]');if(null!==r){var n=parseInt(r.getAttribute("counter"))+1;r.setAttribute("counter",n.toString()),r.textContent=Utils.stringifyCounterValue(n)}return Comment.parseComments([e.data],2)}catch(e){return console.log(e),UI.alert.show("An unexpected error has occurred, please retry later.","Unable to complete the action.","error")}}},t.send("meme="+encodeURIComponent(document.getElementById("meme-id").value)+"&text="+encodeURIComponent(e))}},remove:function(e){var t=e.target.parentNode.parentNode.getAttribute("cid");if(null!==t&&""!==t){var r=Utils.makeConnection();r.open("DELETE","/comments/"+encodeURIComponent(t),!0),r.setRequestHeader("X-CSRF-Token",Utils.getCSRFToken()),r.onreadystatechange=function(){if(r.readyState>3){if(!1===Utils.handleHTTPError(r.status,!0,!0))return!1;try{var t=JSON.parse(r.responseText);if("string"!=typeof t.result||"success"!==t.result)return UI.alert.show("An unexpected error has occurred, please retry later.","Unable to complete the action.","error");var n=null!==document.getElementById("user-id"),o=(a=e.target.parentNode.parentNode).parentNode;if(o.removeChild(a),null===(!0===n?o.querySelector("li.user-comments-list-element-loader"):o.querySelector("li.slide-column-comments-list-element"))){var a;if(null!==(!0===n?o.querySelector("li.user-comments-list-element-loader-link"):o.querySelector("li.meme-comments-list-element-loader-link")))return Comment.loadMoreComments();o.innerHTML="",(a=document.createElement("li")).className=!0===n?"user-comments-list-element-empty user-comments-element-empty common-text":"slide-column-comments-list-element-empty meme-comments-element-empty common-text",a.textContent="No comment found.",o.appendChild(a)}var s=document.querySelector('.slide-column-counters-list-element-counter[scope="comment"]');if(null!==s){var l=parseInt(s.getAttribute("counter"))-1;l<0&&(l=0),s.setAttribute("counter",l.toString()),s.textContent=Utils.stringifyCounterValue(l)}}catch(e){return console.log(e),UI.alert.show("An unexpected error has occurred, please retry later.","Unable to complete the action.","error")}}},r.send()}}},Vote={toggleUpVote:function(e){if(null===e)return Vote.toggle(null,!0);Vote.toggle(e.target.parentNode.parentNode.parentNode.parentNode,!0)},toggleDownVote:function(e){if(null===e)return Vote.toggle(null,!1);Vote.toggle(e.target.parentNode.parentNode.parentNode.parentNode,!1)},toggle:function(e,t){var r=null===e?document.getElementById("meme-id").value:e.getAttribute("mid"),n=!0===t?"1":"0",o=Utils.makeConnection();o.open("POST","/toggleVote/"+r,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.setRequestHeader("X-CSRF-Token",Utils.getCSRFToken()),o.onreadystatechange=function(){if(o.readyState>3){if(!1===Utils.handleHTTPError(o.status,!0,!1))return!1;try{var t=JSON.parse(o.responseText);if("string"!=typeof t.result||"success"!==t.result)return UI.alert.show("An unexpected error has occurred, please retry later.","Unable to complete the action.","error");if(null===e)var r=document.querySelector('.slide-column-counters-list-element-icon[scope="upVote"]'),n=document.querySelector('.slide-column-counters-list-element-counter[scope="upVote"]');else r=e.querySelector('.dashboard-list-element-container-info-icon[scope="upVote"]'),n=e.querySelector('.dashboard-list-element-container-info-counter[scope="upVote"]');if(!0===t.data.positive&&"true"!==r.getAttribute("selected")){var a=parseInt(n.getAttribute("counter"))+1;n.setAttribute("counter",a),n.textContent=Utils.stringifyCounterValue(a),r.setAttribute("selected","true")}else if(!1===t.data.positive&&"true"===r.getAttribute("selected")){(a=parseInt(n.getAttribute("counter"))-1)<0&&(a=0),n.setAttribute("counter",a),n.textContent=Utils.stringifyCounterValue(a),r.setAttribute("selected","false")}if(null===e?(r=document.querySelector('.slide-column-counters-list-element-icon[scope="downVote"]'),n=document.querySelector('.slide-column-counters-list-element-counter[scope="downVote"]')):(r=e.querySelector('.dashboard-list-element-container-info-icon[scope="downVote"]'),n=e.querySelector('.dashboard-list-element-container-info-counter[scope="downVote"]')),!0===t.data.negative&&"true"!==r.getAttribute("selected")){a=parseInt(n.getAttribute("counter"))+1;n.setAttribute("counter",a),n.textContent=Utils.stringifyCounterValue(a),r.setAttribute("selected","true")}else if(!1===t.data.negative&&"true"===r.getAttribute("selected")){(a=parseInt(n.getAttribute("counter"))-1)<0&&(a=0),n.setAttribute("counter",a),n.textContent=Utils.stringifyCounterValue(a),r.setAttribute("selected","false")}}catch(e){return console.log(e),UI.alert.show("An unexpected error has occurred, please retry later.","Unable to complete the action.","error")}}},o.send("value="+n)}},Contact={triggerSubmit:function(e){e.preventDefault(),e.stopPropagation(),Contact.submit()},submit:function(){var e=document.getElementById("about-contact-name").value;if(""===e||e.length>30)return UI.alert.show("You must provide a name, max length is 30 chars.","Invalid name.","error");var t=document.getElementById("about-contact-email").value;if(""===t||t.length>256)return UI.alert.show("You must provide a valid e-mail address.","Invalid e-mail address.","error");var r=document.getElementById("about-contact-message").value;if(""===r||r.length>1e4)return UI.alert.show("You must provide a message, max length is 10000 chars.","Invalid message.","error");var n=document.getElementById("about-contact").action,o=Utils.makeConnection();o.open("POST",n,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.setRequestHeader("X-CSRF-Token",Utils.getCSRFToken()),o.onreadystatechange=function(){if(o.readyState>3){if(!1===Utils.handleHTTPError(o.status,!1))return!1;try{var e=JSON.parse(o.responseText);if("string"!=typeof e.result||"success"!==e.result){switch("number"==typeof e.code?e.code:null){case 1:case 2:return UI.alert.show("You must provide a name, max length is 30 chars.","Invalid name.","error");case 3:return UI.alert.show("You must provide a valid e-mail address.","Invalid e-mail address.","error");case 4:case 5:return UI.alert.show("You must provide a message, max length is 10000 chars.","Invalid message.","error")}return UI.alert.show("An unexpected error has occurred, please retry later.","Unable to complete the action.","error")}document.getElementById("about-contact-name").value="",document.getElementById("about-contact-email").value="",document.getElementById("about-contact-message").value="",alert("Your message has been successfully sent.")}catch(e){return console.log(e),UI.alert.show("An unexpected error has occurred, please retry later.","Unable to complete the action.","error")}}},o.send("name="+encodeURIComponent(e)+"&email="+encodeURIComponent(t)+"&message="+encodeURIComponent(r))}},Newsletter={triggerSubscription:function(e){e.preventDefault(),e.stopPropagation(),Newsletter.subscribe()},subscribe:function(){var e=document.getElementById("dashboard-slide-newsletter-email").value;if(!(""===e||e.length>256)||!(""===(e=document.getElementById("dashboard-slide-newsletter-email-min").value)||e.length>256)){var t=document.getElementById("dashboard-slide-newsletter").action,r=Utils.makeConnection();r.open("POST",t,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.setRequestHeader("X-CSRF-Token",Utils.getCSRFToken()),r.onreadystatechange=function(){if(r.readyState>3)try{var e=JSON.parse(r.responseText);return"string"!=typeof e.result||"success"!==e.result?UI.alert.show("An unexpected error has occurred, please retry later.","Unable to complete the action.","error"):(document.getElementById("dashboard-slide-newsletter-email").value="",document.getElementById("dashboard-slide-newsletter-email-min").value="",UI.alert.show("Your e-mail address has been inserted in our mailing list.","Subscribed successfully!","success"))}catch(e){return console.log(e),UI.alert.show("An unexpected error has occurred, please retry later.","Unable to complete the action.","error")}},r.send("email="+encodeURIComponent(e))}}};switch(!1===UI.cookiePolicy.checkAgreement()&&UI.cookiePolicy.show(),window.location.hash){case"#newsletter.removed":UI.alert.show("Your address has been remove from our newsletter!","E-mail address removed.","success");break;case"#newsletter.error":UI.alert.show("An error occurred while removing your address, retry later.","Unable to remove your e-mail address.","error")}